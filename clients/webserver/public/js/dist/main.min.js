"use strict";(function(){angular.module('GHome',['ngRoute','angularFileUpload']).config(function(a,b){a.when('/home',{templateUrl:'partials/home.html'}).when('/weather',{templateUrl:'partials/weather.html'}).when('/surveillance',{templateUrl:'partials/surveillance.html'}).when('/temperature',{templateUrl:'partials/temperature.html'}).when('/brightness',{templateUrl:'partials/brightness.html'}).when('/power',{templateUrl:'partials/power.html'}).when('/store',{templateUrl:'partials/store.html'}).when('/settings',{templateUrl:'partials/settings.html'}).when('/ai-config',{templateUrl:'partials/ai-config.html'}).otherwise({redirectTo:'/home'});});})();;function MainCtrl(a,b,c){a.supervision={};a.supervision.module='';a.supervision.data={};a.supervision.maxData=10;a.supervision.poll=null;a.$watch('supervision.module',function(){if(a.supervision.poll){a.supervision.poll.cancel();a.supervision.data={};}if(!a.supervision.module)return;a.supervision.poll=b.pollInstances(a.supervision.module,function(b){b.success(function(b){angular.forEach(b,function(b){var c=b.name;angular.forEach(b.attrs,function(d,e){var f=c+'.'+e;if(!a.supervision.data[f])a.supervision.data[f]=[];var g=a.supervision.data[f];g.push([b.time,d]);if(a.supervision.maxData<g.length)g.splice(0,g.length-a.supervision.maxData);});});}).error(function(){});});a.$on('$routeChangeSuccess',function(){a.supervision.poll.cancel();a.supervision.module='';a.supervision.data={};a.supervision.graphData=[];});});c.getRooms().then(function(b){a.rooms=b;});a.map={};a.map.box={};a.map.points=function(a){var b='';angular.forEach(a.polygon,function(c,d){b+=c.x+','+c.y;if(d<a.polygon.length-1)b+=' ';});return b;};a.map.padding=function(){return a.map.paddingRatio*Math.max(a.map.box.maxX-a.map.box.minX,a.map.box.maxY-a.map.box.minY);};a.map.paddingRatio=0.05;a.$watch('rooms',function(){angular.forEach(a.rooms,function(b){angular.forEach(b.polygon,function(b){if(a.map.box.minX===undefined||b.x<a.map.box.minX)a.map.box.minX=b.x;else if(a.map.box.maxX===undefined||b.x>a.map.box.maxX)a.map.box.maxX=b.x;if(a.map.box.minY===undefined||b.y<a.map.box.minY)a.map.box.minY=b.y;else if(a.map.box.maxY===undefined||b.y>a.map.box.maxY)a.map.box.maxY=b.y;});});});};function ModulesCtrl(a,b){a.modules=[];a.reloadModules=function(){b.all().then(function(b){a.modules=b;});};a.reloadModules();a.uploading=false;a.upload=function(c){a.uploading=true;a.upload=b.install(c).progress(function(b){a.uploadProgress=parseInt(100.0*b.loaded/b.total);}).success(function(){a.uploading=false;a.reloadModules();}).error(function(){a.uploading=false;});};a.expandedModule=null;a.toggleActiveModule=function(b){if(a.expandedModule==b)a.expandedModule=null;else a.expandedModule=b;};};angular.module('GHome').directive('graph',function(){return{restrict:'EA',link:function(a,b,c){var d=null,e={xaxis:{tickLength:0},yaxis:{tickLength:0},grid:{borderWidth:0,aboveData:true,markings:[{yaxis:{from:0,to:0},color:'#888'},{xaxis:{from:0,to:0},color:'#888'}]},series:{shadowSize:0,points:{show:true},lines:{show:true}}};a.$watch(c.graphModel,function(a){var c=[];if(a instanceof Array)c=a;else angular.forEach(a,function(a,b){c.push({label:b,data:a});});if(!d){d=$.plot(b,c,e);b.css('display','block');}else{d.setData(c);d.setupGrid();d.draw();}},true);}};});;angular.module('GHome').directive('svgVbox',function(){return{link:function(a,b,c){var d=0;c.$observe('svgVboxPadding',function(b){if(b===undefined)return;b=parseFloat(a.$eval(b));d=b;});a.$watch(c.svgVbox,function(a){if(a.minX===undefined)a.minX=0;if(a.maxX===undefined)a.maxX=0;if(a.minY===undefined)a.minY=0;if(a.maxY===undefined)a.maxY=0;var c=a.minX-d,e=a.minY-d,f=(a.maxX-a.minX)+2*d,g=(a.maxY-a.minY)+2*d;b[0].setAttribute('viewBox',c+' '+e+' '+f+' '+g);});}};});;angular.module('GHome').factory('HouseMapService',function(a,b,c){var d={};d.getRooms=function(){var b=a.defer();c.get('/api/rooms').success(function(a){b.resolve(a);});return b.promise;};return d;});;angular.module('GHome').factory('ModuleService',function(a,b,c,d){var e={defaultPollingDelay:1000};e.modules=[];e.all=function(c){var d=a.defer();if(!c)b.get('/api/modules').success(function(a){e.modules=a;d.resolve(a);});else d.resolve(this.modules);return d.promise;};e.pollInstances=function(a,d,f){if(f===undefined)f=e.defaultPollingDelay;var g=c(function h(){d(b.get('/api/modules/'+a+'/instances/status'));g=c(h,f);},f);return{cancel:function(){c.cancel(g);}};};e.install=function(a){return d.upload({url:'/api/modules/install',method:'POST',file:a});};return e;});